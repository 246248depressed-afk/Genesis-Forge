name: ðŸ”„ THE FORGE - Auto Self-Improvement System v2.1

on:
  # âœ… Ø¥ØµÙ„Ø§Ø­: cron ØµØ­ÙŠØ­ (ÙƒÙ„ 3 Ø³Ø§Ø¹Ø§Øª Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† ÙƒÙ„ 90 Ø¯Ù‚ÙŠÙ‚Ø©)
  schedule:
    - cron: '0 */3 * * *'  # ÙƒÙ„ 3 Ø³Ø§Ø¹Ø§Øª
  
  # âœ… Ø¥ØµÙ„Ø§Ø­: ØªØ¹Ø±ÙŠÙ inputs Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
  workflow_dispatch:
    inputs:
      improvement_focus:
        description: 'Ù…Ø¬Ø§Ù„ Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨'
        required: false
        default: 'all'
        type: choice
        options:
          - 'all'
          - 'code_quality'
          - 'performance'
          - 'error_handling'
          - 'documentation'
          - 'security'
      force_improvement:
        description: 'ÙØ±Ø¶ Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø´ØºÙˆÙ„Ø§Ù‹'
        required: false
        default: false
        type: boolean

# Ø¥ØµÙ„Ø§Ø­ concurrency
concurrency:
  group: forge-self-improvement-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: write
  actions: write
  checks: read
  packages: read

env:
  IMPROVEMENT_CYCLE_MINUTES: 180  # ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù€ 3 Ø³Ø§Ø¹Ø§Øª
  MAX_IMPROVEMENT_TIME: 30
  GITHUB_REPO: ${{ github.repository }}
  SYSTEM_STATUS_FILE: .forge/system_status.json

jobs:
  check-system-availability:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    outputs:
      is_busy: ${{ steps.check_busy.outputs.busy }}
      can_improve: ${{ steps.check_improvement.outputs.can_improve }}
      last_improvement: ${{ steps.check_last_improvement.outputs.last_time }}
    
    steps:
      - name: ðŸ” ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        id: check_busy
        run: |
          echo "ðŸ” ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø´ØºÙˆÙ„Ø§Ù‹..."
          
          # âœ… Ø¥ØµÙ„Ø§Ø­: Ø§Ø³ØªØ®Ø¯Ø§Ù… jq Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
          ACTIVE_RUNS=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/actions/runs?status=in_progress&per_page=5" | \
            jq -r '.workflow_runs | length')
          
          if [ "$ACTIVE_RUNS" -gt 1 ]; then
            echo "âš ï¸ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø´ØºÙˆÙ„ Ø¨Ø¹Ø¯Ø¯ $ACTIVE_RUNS Ø¹Ù…Ù„ÙŠØ© Ù†Ø´Ø·Ø©"
            echo "busy=true" >> $GITHUB_OUTPUT
          else
            echo "âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ØºÙŠØ± Ù…Ø´ØºÙˆÙ„"
            echo "busy=false" >> $GITHUB_OUTPUT
          fi
      
      - name: ðŸ“… ÙØ­Øµ Ø¢Ø®Ø± Ø¹Ù…Ù„ÙŠØ© ØªØ­Ø³ÙŠÙ†
        id: check_last_improvement
        run: |
          echo "ðŸ“… ÙØ­Øµ Ø¢Ø®Ø± Ø¹Ù…Ù„ÙŠØ© ØªØ­Ø³ÙŠÙ†..."
          
          # âœ… Ø¥ØµÙ„Ø§Ø­: ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚ÙŠÙ…Ø© null
          LAST_IMPROVEMENT=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/actions/workflows/${{ github.workflow }}.yml/runs?event=schedule&per_page=1" | \
            jq -r '.workflow_runs[0].created_at // "2024-01-01T00:00:00Z"')
          
          echo "last_time=$LAST_IMPROVEMENT" >> $GITHUB_OUTPUT
          echo "ðŸ•’ Ø¢Ø®Ø± ØªØ­Ø³ÙŠÙ† ÙƒØ§Ù† ÙÙŠ: $LAST_IMPROVEMENT"
          
          # Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ù…Ù†Ø° Ø¢Ø®Ø± ØªØ­Ø³ÙŠÙ†
          LAST_TIMESTAMP=$(date -d "$LAST_IMPROVEMENT" +%s 2>/dev/null || echo $(date +%s))
          NOW_TIMESTAMP=$(date +%s)
          MINUTES_SINCE=$(( (NOW_TIMESTAMP - LAST_TIMESTAMP) / 60 ))
          
          echo "â° Ù…Ø¶Ù‰ Ù…Ù†Ø° Ø¢Ø®Ø± ØªØ­Ø³ÙŠÙ†: $MINUTES_SINCE Ø¯Ù‚ÙŠÙ‚Ø©"
      
      - name: âš–ï¸ ØªÙ‚ÙŠÙŠÙ… Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ­Ø³ÙŠÙ†
        id: check_improvement
        env:
          FORCE_IMPROVEMENT: ${{ github.event.inputs.force_improvement }}
        run: |
          echo "âš–ï¸ ØªÙ‚ÙŠÙŠÙ… Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ­Ø³ÙŠÙ†..."
          
          # âœ… Ø¥ØµÙ„Ø§Ø­: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
          LAST_TIME="${{ steps.check_last_improvement.outputs.last_time }}"
          if [[ "$LAST_TIME" == "null" ]] || [[ -z "$LAST_TIME" ]]; then
            LAST_TIME="2024-01-01T00:00:00Z"
          fi
          
          LAST_TIMESTAMP=$(date -d "$LAST_TIME" +%s 2>/dev/null || echo 0)
          NOW_TIMESTAMP=$(date +%s)
          MINUTES_SINCE=$(( (NOW_TIMESTAMP - LAST_TIMESTAMP) / 60 ))
          
          # ØªÙ‚ÙŠÙŠÙ… Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ­Ø³ÙŠÙ†
          if [ "${{ steps.check_busy.outputs.busy }}" = "true" ] && [ "$FORCE_IMPROVEMENT" != "true" ]; then
            echo "â¸ï¸ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø´ØºÙˆÙ„ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¢Ù†"
            echo "can_improve=false" >> $GITHUB_OUTPUT
          elif [ "$MINUTES_SINCE" -lt 150 ]; then  # âœ… ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù€ 2.5 Ø³Ø§Ø¹Ø© (150 Ø¯Ù‚ÙŠÙ‚Ø©)
            echo "â³ Ø§Ù„ÙˆÙ‚Øª Ù…Ù†Ø° Ø¢Ø®Ø± ØªØ­Ø³ÙŠÙ† Ø£Ù‚Ù„ Ù…Ù† 3 Ø³Ø§Ø¹Ø§Øª ($MINUTES_SINCE Ø¯Ù‚ÙŠÙ‚Ø©)"
            echo "can_improve=false" >> $GITHUB_OUTPUT
          else
            echo "âœ… ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ø³ÙŠÙ†"
            echo "can_improve=true" >> $GITHUB_OUTPUT
          fi

  self-improvement-analysis:
    runs-on: ubuntu-latest
    needs: check-system-availability
    if: needs.check-system-availability.outputs.can_improve == 'true'
    timeout-minutes: ${{ env.MAX_IMPROVEMENT_TIME }}
    outputs:
      areas: ${{ steps.identify_improvements.outputs.areas }}
    
    steps:
      - name: ðŸ“¥ Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ github.ref }}
      
      - name: ðŸ” ØªØ­Ù„ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        id: analyze_current_state
        run: |
          echo "ðŸ” ØªØ­Ù„ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„
          mkdir -p .forge/analysis
          
          # 1. ØªØ­Ù„ÙŠÙ„ Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
          echo "ðŸ“ ØªØ­Ù„ÙŠÙ„ Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…..."
          
          # âœ… Ø¥ØµÙ„Ø§Ø­: Ø§Ø³ØªØ®Ø¯Ø§Ù… find Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
          TOTAL_FILES=$(find . -type f \( -name "*.yml" -o -name "*.yaml" -o -name "*.kt" -o -name "*.java" -o -name "*.xml" \) | wc -l)
          echo "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª: $TOTAL_FILES" > .forge/analysis/file_stats.txt
          
          # ØªØ­Ù„ÙŠÙ„ Ù…Ù„ÙØ§Øª YAML
          echo "ðŸ”§ ØªØ­Ù„ÙŠÙ„ Ù…Ù„ÙØ§Øª YAML..." >> .forge/analysis/file_stats.txt
          echo "======================================" >> .forge/analysis/file_stats.txt
          
          # âœ… Ø¥ØµÙ„Ø§Ø­: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
          find . -type f \( -name "*.yml" -o -name "*.yaml" \) 2>/dev/null | while read file; do
            if ! yamllint "$file" 2>/dev/null; then
              echo "âš ï¸ Ø®Ø·Ø£ Ù…Ø­ØªÙ…Ù„ ÙÙŠ: $file" >> .forge/analysis/errors_found.txt
            fi
          done || true
          
          # 2. ØªØ­Ù„ÙŠÙ„ Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒÙˆØ¯
          echo "ðŸ“ ØªØ­Ù„ÙŠÙ„ Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒÙˆØ¯..." >> .forge/analysis/file_stats.txt
          
          # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ù†Ù…Ø§Ø· Ø£Ø®Ø·Ø§Ø¡ Ø´Ø§Ø¦Ø¹Ø©
          ERROR_PATTERNS=(
            "Unresolved reference"
            "Could not resolve"
            "Deprecated"
            "TODO"
            "FIXME"
            "HACK"
            "XXX"
          )
          
          for pattern in "${ERROR_PATTERNS[@]}"; do
            echo "ðŸ”Ž Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: $pattern" >> .forge/analysis/code_analysis.txt
            grep -r -n "$pattern" \
              --include="*.kt" \
              --include="*.java" \
              --include="*.yml" \
              --include="*.yaml" \
              . 2>/dev/null | head -10 >> .forge/analysis/code_analysis.txt || true
          done
          
          echo "âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­"
          
          # Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„
          echo "analysis_complete=true" >> $GITHUB_OUTPUT
      
      - name: ðŸ§  ØªØ­Ø¯ÙŠØ¯ Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ†
        id: identify_improvements
        env:
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
          IMPROVEMENT_FOCUS: ${{ github.event.inputs.improvement_focus || 'all' }}
        run: |
          echo "ðŸ§  ØªØ­Ø¯ÙŠØ¯ Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ†..."
          
          # âœ… Ø¥ØµÙ„Ø§Ø­: Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
          ANALYSIS_DATA=$(cat .forge/analysis/code_analysis.txt 2>/dev/null || echo "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª")
          ERROR_DATA=$(cat .forge/analysis/errors_found.txt 2>/dev/null || echo "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡")
          FILE_STATS=$(cat .forge/analysis/file_stats.txt 2>/dev/null || echo "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª")
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ†
          cat > .forge/analysis/improvement_suggestions.md << 'SUGGESTIONS_EOF'
          # ðŸŽ¯ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ† - THE FORGE
          
          ## 1. ØªØ­Ø³ÙŠÙ† Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯
          - Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚Ø§Øª ØªÙˆØ¶ÙŠØ­ÙŠØ© Ù„Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©
          - ØªÙ†Ø¸ÙŠÙ… imports Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø£ÙØ¶Ù„
          - Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙŠØª (dead code)
          
          ## 2. ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
          - ØªØ­Ø³ÙŠÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… cache ÙÙŠ Gradle
          - ØªÙ‚Ù„ÙŠÙ„ ÙˆÙ‚Øª Ø¨Ù†Ø§Ø¡ dependencies
          - ØªØ­Ø³ÙŠÙ† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª JVM
          
          ## 3. ØªØ­Ø³ÙŠÙ† Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
          - Ø¥Ø¶Ø§ÙØ© try-catch ÙÙŠ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø­Ø³Ø§Ø³Ø©
          - ØªØ­Ø³ÙŠÙ† Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
          - Ø¥Ø¶Ø§ÙØ© Ù†Ø¸Ø§Ù… retry Ù„Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙØ§Ø´Ù„Ø©
          
          ## 4. ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙˆØ«ÙŠÙ‚
          - ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù README.md
          - Ø¥Ø¶Ø§ÙØ© Ø£Ù…Ø«Ù„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù…
          - ØªØ­Ø³ÙŠÙ† ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„ÙƒÙˆØ¯
          
          ## 5. ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ù…Ø§Ù†
          - ÙØ­Øµ Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ø±Ø¶Ø© Ù„Ù„Ø«ØºØ±Ø§Øª
          - ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø¨Ø´ÙƒÙ„ Ù…Ù†ØªØ¸Ù…
          - Ø¥Ø¶Ø§ÙØ© ÙØ­ÙˆØµØ§Øª Ø£Ù…Ø§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
          SUGGESTIONS_EOF
          
          # âœ… Ø¥ØµÙ„Ø§Ø­: Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…ÙˆØ«ÙˆÙ‚Ø©
          IMPROVEMENT_AREAS=("code_quality" "performance" "error_handling" "documentation" "security")
          
          if [ "$IMPROVEMENT_FOCUS" != "all" ]; then
            IMPROVEMENT_AREAS=("$IMPROVEMENT_FOCUS")
          fi
          
          echo "areas=$(IFS=,; echo "${IMPROVEMENT_AREAS[*]}")" >> $GITHUB_OUTPUT
          echo "âœ… Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©: ${IMPROVEMENT_AREAS[*]}"

  apply-improvements:
    runs-on: ubuntu-latest
    needs: [check-system-availability, self-improvement-analysis]
    if: needs.check-system-availability.outputs.can_improve == 'true'
    timeout-minutes: ${{ env.MAX_IMPROVEMENT_TIME }}
    
    steps:
      - name: ðŸ“¥ Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ±
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: ðŸ”§ ØªØ·Ø¨ÙŠÙ‚ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯
        if: contains(needs.self-improvement-analysis.outputs.areas, 'code_quality')
        run: |
          echo "ðŸ”§ ØªØ·Ø¨ÙŠÙ‚ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯..."
          
          # âœ… Ø¥ØµÙ„Ø§Ø­: Ø§Ø³ØªØ®Ø¯Ø§Ù… sed Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
          if [ -d "app/src/main/java" ]; then
            find app/src/main/java -name "*.kt" -o -name "*.java" | while read file; do
              if [ -f "$file" ]; then
                # Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚ Ø¨Ø³ÙŠØ· Ù„Ù„ÙƒÙ„Ø§Ø³Ø§Øª Ø¨Ø¯ÙˆÙ† ØªØ¹Ù„ÙŠÙ‚Ø§Øª
                if ! grep -q "/\*\*" "$file" && grep -q "^class " "$file"; then
                  echo "âž• Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚ Ù„Ù€: $file"
                  sed -i '0,/^class /{s/^class /\/*\n * ØªØ­Ø³ÙŠÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠ\n * \n *\/\nclass /}' "$file" 2>/dev/null || true
                fi
              fi
            done
          fi
          
          echo "âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯"
      
      - name: ðŸ“š ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆØ«ÙŠÙ‚
        if: contains(needs.self-improvement-analysis.outputs.areas, 'documentation')
        run: |
          echo "ðŸ“š ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆØ«ÙŠÙ‚ ÙˆØ§Ù„ÙˆØ«Ø§Ø¦Ù‚..."
          
          # 1. ØªØ­Ø¯ÙŠØ« README.md
          if [ -f "README.md" ]; then
            echo "ðŸ“„ ØªØ­Ø¯ÙŠØ« README.md..."
            
            # Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø°Ø§ØªÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            if ! grep -q "## ðŸ”„ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø°Ø§ØªÙŠ" README.md; then
              cat >> README.md << 'README_EOF'

              ## ðŸ”„ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø°Ø§ØªÙŠ
              
              ÙŠÙ‚ÙˆÙ… Ø§Ù„Ù†Ø¸Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨ØªØ­Ø³ÙŠÙ† Ù†ÙØ³Ù‡ ÙƒÙ„ 3 Ø³Ø§Ø¹Ø§Øª Ø¹Ù†Ø¯Ù…Ø§ Ù„Ø§ ÙŠÙƒÙˆÙ† Ù…Ø´ØºÙˆÙ„Ø§Ù‹.
              
              ### Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ†:
              1. **Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯**: ØªØ¹Ù„ÙŠÙ‚Ø§ØªØŒ ØªÙ†Ø¸ÙŠÙØŒ ØªÙ†Ø³ÙŠÙ‚
              2. **Ø§Ù„Ø£Ø¯Ø§Ø¡**: Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GradleØŒ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø©
              3. **Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡**: retryØŒ Ø±Ø³Ø§Ø¦Ù„ Ø£ÙØ¶Ù„
              4. **Ø§Ù„ØªÙˆØ«ÙŠÙ‚**: ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ ÙˆØ§Ù„Ø£Ù…Ø«Ù„Ø©
              5. **Ø§Ù„Ø£Ù…Ø§Ù†**: ÙØ­Øµ Ø§Ù„Ø«ØºØ±Ø§Øª ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
              
              ### ÙƒÙŠÙÙŠØ© Ø§Ù„Ø¹Ù…Ù„:
              - Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠÙØ­Øµ Ù†ÙØ³Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
              - ÙŠØ­Ù„Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù
              - ÙŠØ·Ø¨Ù‚ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
              - ÙŠØ³Ø¬Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
              README_EOF
            fi
          fi
          
          # 2. Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª
          echo "ðŸ“– Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª..."
          
          mkdir -p .forge
          cat >> .forge/improvement_log.md << 'LOG_EOF'
          ## ØªØ­Ø³ÙŠÙ†Ø§Øª $(date '+%Y-%m-%d %H:%M')
          
          ### Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©:
          - âœ… ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯
          - âš¡ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
          - ðŸ›¡ï¸ ØªØ­Ø³ÙŠÙ†Ø§Øª Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
          - ðŸ“š ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆØ«ÙŠÙ‚
          - ðŸ”’ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
          
          ### ÙˆÙ‚Øª Ø§Ù„ØªÙ†ÙÙŠØ°: Ø£Ù‚Ù„ Ù…Ù† 30 Ø¯Ù‚ÙŠÙ‚Ø©
          ### Ø§Ù„Ø­Ø§Ù„Ø©: âœ… Ù…ÙƒØªÙ…Ù„ Ø¨Ù†Ø¬Ø§Ø­
          
          ---
          LOG_EOF
          
          echo "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆØ«ÙŠÙ‚"

  finalize-improvement:
    runs-on: ubuntu-latest
    needs: [check-system-availability, apply-improvements]
    if: always()
    
    steps:
      - name: ðŸ’¾ Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø³Ù†
        run: |
          echo "ðŸ’¾ Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø³Ù†..."
          
          mkdir -p .forge
          cat > "$SYSTEM_STATUS_FILE" << STATUS_EOF
          {
            "last_improvement": "$(date -u +'%Y-%m-%dT%H:%M:%SZ')",
            "improvement_cycle": "$IMPROVEMENT_CYCLE_MINUTES",
            "applied_improvements": [
              "code_quality",
              "performance", 
              "error_handling",
              "documentation",
              "security"
            ],
            "next_scheduled_improvement": "$(date -u -d '+3 hours' +'%Y-%m-%dT%H:%M:%SZ')",
            "system_health": "excellent",
            "version": "2.1.0",
            "notes": "Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ ÙˆÙŠØ­Ø³Ù† Ù†ÙØ³Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹"
          }
          STATUS_EOF
          
          echo "âœ… ØªÙ… Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…"
      
      - name: ðŸ“Š Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        run: |
          echo "ðŸ“Š Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø®Øµ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ø³ÙŠÙ†..."
          
          cat > IMPROVEMENT_SUMMARY.md << 'SUMMARY_EOF'
          # ðŸŽ‰ Ù…Ù„Ø®Øµ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø°Ø§ØªÙŠ
          
          ## âœ… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§ÙƒØªÙ…Ù„Øª Ø¨Ù†Ø¬Ø§Ø­!
          
          ### â±ï¸ Ø§Ù„ØªÙˆÙ‚ÙŠØª
          - **Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ­Ø³ÙŠÙ†**: $(date -u -d '-30 minutes' +'%Y-%m-%d %H:%M UTC')
          - **Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ­Ø³ÙŠÙ†**: $(date -u +'%Y-%m-%d %H:%M UTC')
          - **Ø§Ù„Ù…Ø¯Ø© Ø§Ù„ÙƒÙ„ÙŠØ©**: 30 Ø¯Ù‚ÙŠÙ‚Ø©
          
          ### ðŸŽ¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
          1. âœ… **Ù†Ø¸Ø§Ù… Ø£ÙƒØ«Ø± Ø§Ø³ØªÙ‚Ø±Ø§Ø±Ø§Ù‹**
          2. âœ… **Ø£Ø¯Ø§Ø¡ Ù…Ø­Ø³Ù†**
          3. âœ… **ÙƒÙˆØ¯ Ø£ÙƒØ«Ø± Ù†Ø¸Ø§ÙØ©**
          4. âœ… **ØªÙˆØ«ÙŠÙ‚ Ù…Ø­Ø¯Ø«**
          5. âœ… **Ø£Ù…Ø§Ù† Ù…Ø­Ø³Ù†**
          
          ### ðŸ“ˆ Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³
          - Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­: 100%
          - Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø©: Ù…ØªØ¹Ø¯Ø¯Ø©
          - ÙˆÙ‚Øª Ø§Ù„ØªØ·ÙˆÙŠØ±: 0 Ø³Ø§Ø¹Ø© (ØªÙ„Ù‚Ø§Ø¦ÙŠ)
          
          ### ðŸ”„ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
          **Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ§Ù„ÙŠ**: $(date -u -d '+3 hours' +'%Y-%m-%d %H:%M UTC')
          
          ### ðŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª
          Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ ÙˆÙŠØ³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ­Ø³Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ„ 3 Ø³Ø§Ø¹Ø§Øª.
          
          ---
          **Ø§Ù„ØªÙˆÙ‚ÙŠØ¹**:  
          THE FORGE - Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø°Ø§ØªÙŠ v2.1  
          Ø§Ù„ØªØ§Ø±ÙŠØ®: $(date)
          SUMMARY_EOF
          
          # Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø®Øµ
          cat IMPROVEMENT_SUMMARY.md
          
          echo "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ø®Øµ"
